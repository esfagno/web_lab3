<!DOCTYPE html>
<html xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns="http://www.w3.org/1999/xhtml">

<f:view locale="en">
    <h:head>
        <title>Проверка попадания точки</title>
        <h:outputStylesheet name="css/style.css"/>
    </h:head>

    <h:body>
        <h:messages id="messages"
                    style="color: red; text-align: center; margin-bottom: 15px;"/>

        <div class="content-container">
            <!-- Левая панель с кнопкой и таблицей -->
            <div class="left-panel">
                <div class="back-link-wrapper">
                    <h:link value="На главную" outcome="start" styleClass="back-button"/>
                </div>
                <div class="table-container">
                    <div class="results-scroll">
                        <p:dataTable id="resultsTable"
                                     value="#{resultsManager.allResults}"
                                     var="res"
                                     style="width:100%; min-width:100%;">

                            <p:column headerText="X" style="text-align:center;">
                                <h:outputText value="#{res.x}"/>
                            </p:column>

                            <p:column headerText="Y" style="text-align:center;">
                                <h:outputText value="#{res.y}"/>
                            </p:column>

                            <p:column headerText="R" style="text-align:center;">
                                <h:outputText value="#{res.r}"/>
                            </p:column>

                            <p:column headerText="Result" style="text-align:center;">
                    <span style="color: #{res.hit ? 'green' : 'red'};">
                        #{res.hit ? 'hit' : 'miss'}
                    </span>
                            </p:column>

                            <p:column headerText="Time" style="text-align:center;">
                                <h:outputText value="#{res.timestamp}"/>
                            </p:column>
                        </p:dataTable>
                    </div>
                </div>
            </div>

            <!-- Правая панель с графиком и формой -->
            <div class="right-panel">
                <div class="canvas-wrapper">
                    <div class="canvas-wrapper-inner">
                        <canvas id="coordinatePlane" width="400" height="400"></canvas>
                    </div>
                </div>

                <h:form id="pointForm">
                    <div class="form-container">
                        <div class="input-container x-radio-group">
                            <label>X:</label>
                            <p:selectOneRadio id="xValue"
                                              value="#{mainBean.x}"
                                              layout="grid"
                                              columns="3"
                                              required="true"
                                              requiredMessage="Пожалуйста, выберите X.">
                                <f:selectItems value="#{[-5,-4,-3,-2,-1,0,1,2,3]}"/>
                                <p:ajax event="change" oncomplete="redrawCanvas()"/>
                            </p:selectOneRadio>
                            <p:message for="xValue" display="text"/>
                        </div>

                        <div class="narrow-inputs-wrapper">
                            <div class="input-container narrow-input">
                                <label for="pointForm:yValue">Y:</label>
                                <p:inputNumber id="yValue"
                                               value="#{mainBean.y}"
                                               decimalPlaces="8"
                                               placeholder="(-5 ... 3)"
                                               required="true"
                                               requiredMessage="Поле Y обязательно.">
                                    <f:validator validatorId="inputValidator"/>
                                    <p:ajax event="blur" oncomplete="redrawCanvas()"/>
                                </p:inputNumber>
                                <p:message for="yValue" display="text"/>
                            </div>

                            <div class="input-container narrow-input">
                                <label for="pointForm:rValue">R:</label>
                                <p:inputNumber id="rValue"
                                               value="#{mainBean.r}"
                                               decimalPlaces="8"
                                               placeholder="(2 ... 5)"
                                               required="true"
                                               requiredMessage="Поле R обязательно.">
                                    <f:validator validatorId="inputValidator"/>
                                    <p:ajax event="blur" oncomplete="redrawCanvas()"/>
                                </p:inputNumber>
                                <p:message for="rValue" display="text"/>
                            </div>
                        </div>

                        <p:commandButton value="Submit"
                                         action="#{mainBean.checkPoint}"
                                         process="@form"
                                         update="messages, resultsTable"
                                         oncomplete="handleAjaxComplete()"
                                         styleClass="submit-button"/>

                        <p:remoteCommand name="sendCanvasClick"
                                         action="#{mainBean.handleCanvasClick}"
                                         process="@this"
                                         update="messages, resultsTable, pointForm:xValue, pointForm:yValue, pointForm:rValue"
                                         oncomplete="handleAjaxComplete()"
                                         global="false">
                            <f:param name="clickedX" value=""/>
                            <f:param name="clickedY" value=""/>
                            <f:param name="clickedR" value=""/>
                        </p:remoteCommand>
                    </div>
                </h:form>
            </div>
        </div>
        <h:outputScript name="js/script.js"/>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                setTimeout(redrawCanvas, 100);
            });
        </script>
    </h:body>

</f:view>
</html>