<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<f:view locale="en">
    <h:head>
        <title>Проверка попадания точки</title>
        <h:outputStylesheet name="css/style.css" />
    </h:head>
    <h:body>
        <h:messages id="messages" style="color: red; text-align: center; margin-bottom: 15px;" />

        <div class="content-container">
            <div class="table-container">
                <div class="results-scroll">
                    <p:dataTable id="resultsTable" value="#{resultsManager.allResults}" var="res"
                                 style="width:100%; min-width:100%;">
                        <p:column headerText="X" style="text-align:center;">#{res.x}</p:column>
                        <p:column headerText="Y" style="text-align:center;">#{res.y}</p:column>
                        <p:column headerText="R" style="text-align:center;">#{res.r}</p:column>
                        <p:column headerText="Result" style="text-align:center;">
                            <span style="color: #{res.hit ? 'green' : 'red'};">
                                #{res.hit ? 'hit' : 'miss'}
                            </span>
                        </p:column>
                        <p:column headerText="Time" style="text-align:center;">#{res.timestamp}</p:column>
                    </p:dataTable>
                </div>
            </div>

            <canvas id="coordinatePlane" width="400" height="400"></canvas>
        </div>

        <h:form id="pointForm">
            <div class="form-container">
                <div class="input-container">
                    <label for="xValue">X:</label>
                    <p:inputNumber id="xValue" value="#{mainBean.x}"
                                   minValue="-4" maxValue="4" decimalPlaces="0"
                                   placeholder="-4 ... 4">
                        <p:ajax event="blur" />
                    </p:inputNumber>
                </div>

                <div class="input-container">
                    <label for="yValue">Y:</label>
                    <p:inputNumber id="yValue" value="#{mainBean.y}"
                                   minValue="-5" maxValue="3" decimalPlaces="2"
                                   placeholder="(-5 ... 3)">
                        <p:ajax event="blur" />
                    </p:inputNumber>
                </div>

                <div class="input-container">
                    <label for="rValue">R:</label>
                    <p:inputNumber id="rValue" value="#{mainBean.r}"
                                   minValue="1" maxValue="4" decimalPlaces="0"
                                   placeholder="1...4">
                        <p:ajax event="blur" />
                    </p:inputNumber>
                </div>

                <p:commandButton value="Submit"
                                 action="#{mainBean.checkPoint}"
                                 process="@form"
                                 update="messages, resultsTable"
                                 oncomplete="redrawCanvas()" />
            </div>
        </h:form>


        <h:form id="canvasClickForm">
            <h:inputHidden id="canvasX" value="#{mainBean.x}" />
            <h:inputHidden id="canvasY" value="#{mainBean.y}" />
            <h:inputHidden id="canvasR" value="#{mainBean.r}" />
            <h:commandButton id="submitCanvasClick" style="display:none">
                <f:ajax
                        execute="@form"
                        listener="#{mainBean.checkPoint}"
                        render="messages, resultsTable"
                        oncomplete="redrawCanvas()" />
            </h:commandButton>
        </h:form>

        <script>
            const results = [
                <ui:repeat value="#{resultsManager.allResults}" var="res">
                    {x: #{res.x}, y: #{res.y}, r: #{res.r}, hit: #{res.hit}},
                </ui:repeat>
            ];
        </script>

        <h:outputScript name="js/script.js" />

        <script>
            function redrawCanvas() {
                if (window.coordinatePlane) {
                    window.coordinatePlane.draw();
                }
            }
        </script>
    </h:body>
</f:view>
</html>